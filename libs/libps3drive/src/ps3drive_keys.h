/*
 * This file is part of DSD-Nexus.
 * Copyright (c) 2026 Alexander Wichers
 *
 * @brief Fixed cryptographic keys for PS3 drive operations.
 * RSA keys verified against SacModule.spu.self emulator output.
 * These are the DECRYPTED keys used for SAC key exchange.
 *
 * DSD-Nexus is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * DSD-Nexus is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with DSD-Nexus; if not, see <https://www.gnu.org/licenses/>.
 */

#ifndef LIBPS3DRIVE_PS3DRIVE_KEYS_H
#define LIBPS3DRIVE_PS3DRIVE_KEYS_H

#include <stdint.h>

#ifdef __cplusplus
extern "C" {
#endif

/* ============================================================================
 * BD AUTHENTICATION KEYS
 *
 * These keys are used for the BD drive authentication protocol in
 * auth_bd_drive(). The authentication establishes a session with the
 * drive before SAC key exchange can occur.
 * ============================================================================ */

/** Primary authentication key 1 */
static const uint8_t PS3DRIVE_AUTH_KEY1[16] = {
    0x04, 0xda, 0x54, 0x4f, 0xd9, 0x38, 0x79, 0x23,
    0x5d, 0x4d, 0xda, 0x4d, 0x47, 0x63, 0x5b, 0xd9
};

/** Primary authentication key 2 */
static const uint8_t PS3DRIVE_AUTH_KEY2[16] = {
    0x7d, 0x8f, 0x49, 0x36, 0x54, 0x1c, 0x00, 0x8f,
    0x8d, 0x46, 0x2f, 0x6b, 0x0d, 0x41, 0x4e, 0xf3
};

/** AES IV for first authentication phase */
static const uint8_t PS3DRIVE_AUTH_IV1[16] = {
    0x22, 0x26, 0x92, 0x8d, 0x44, 0x03, 0x2f, 0x43,
    0x6a, 0xfd, 0x26, 0x7e, 0x74, 0x8b, 0x23, 0x93
};

/** DES IV for authentication (8 bytes) */
static const uint8_t PS3DRIVE_AUTH_IV2[8] = {
    0xe8, 0x0b, 0x3f, 0x0c, 0xd6, 0x56, 0x6d, 0xd0
};

/** AES IV for second authentication phase */
static const uint8_t PS3DRIVE_AUTH_IV3[16] = {
    0x3b, 0xd6, 0x24, 0x02, 0x0b, 0xd3, 0xf8, 0x65,
    0xe8, 0x0b, 0x3f, 0x0c, 0xd6, 0x56, 0x6d, 0xd0
};

/** Session derivation key 3 */
static const uint8_t PS3DRIVE_AUTH_KEY3[16] = {
    0x12, 0x6c, 0x6b, 0x59, 0x45, 0x37, 0x0e, 0xee,
    0xca, 0x68, 0x26, 0x2d, 0x02, 0xdd, 0x12, 0xd2
};

/** Session derivation key 4 */
static const uint8_t PS3DRIVE_AUTH_KEY4[16] = {
    0xd9, 0xa2, 0x0a, 0x79, 0x66, 0x6c, 0x27, 0xd1,
    0x10, 0x32, 0xac, 0xcf, 0x0d, 0x7f, 0xb5, 0x01
};

/** Session derivation key 5 */
static const uint8_t PS3DRIVE_AUTH_KEY5[16] = {
    0x19, 0x76, 0x6f, 0xbc, 0x77, 0xe4, 0xe7, 0x5c,
    0xf4, 0x41, 0xe4, 0x8b, 0x94, 0x2c, 0x5b, 0xd9
};

/** Session derivation key 6 */
static const uint8_t PS3DRIVE_AUTH_KEY6[16] = {
    0x50, 0xcb, 0xa7, 0xf0, 0xc2, 0xa7, 0xc0, 0xf6,
    0xf3, 0x3a, 0x21, 0x43, 0x26, 0xac, 0x4e, 0xf3
};

/** Fixed command data for authentication (0x4_14 command) */
static const uint8_t PS3DRIVE_CMD_4_14[64] = {
    0x1e, 0x79, 0x18, 0x8e, 0x09, 0x3b, 0xc8, 0x77,
    0x95, 0xb2, 0xcf, 0x2a, 0xe7, 0xaf, 0x9b, 0xb4,
    0x86, 0x80, 0x18, 0x28, 0xc2, 0xca, 0x05, 0xba,
    0xd1, 0xf2, 0x78, 0xf1, 0x80, 0x1f, 0xea, 0xcb,
    0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x8d, 0xb3, 0x46, 0x93, 0x42, 0x64, 0x81, 0x60,
    0x16, 0x8f, 0x51, 0xd1, 0x93, 0x76, 0x23, 0x95
};

/* ============================================================================
 * SAC KEY EXCHANGE KEYS (RSA)
 *
 * VERIFIED: Extracted from SacModule.spu.self emulator run after CMD 0x00
 * decrypts the embedded RSA key blobs.
 * ============================================================================ */

/**
 * RSA=1024 public key blob (175 bytes)
 * 
 * This is the full decrypted blob from LS offset 0xD650.
 * First 128 bytes is the Modulus
 * Middle 44 bytes are unknown, probably a hash
 * Last 4 bytes are public exponent E = 0x00010001 (65537)
 */
static const uint8_t PS3DRIVE_RSA175_BLOB[175] = {
    // Modulus
    0x00, 0xa0, 0x98, 0x53, 0xc2, 0xaf, 0x50, 0x6f, 0x5f, 0x88, 0x76, 0xab, 0x45, 0x43, 0x23, 0x3c,
    0x48, 0x04, 0x5a, 0xc0, 0x42, 0xed, 0x5b, 0x3c, 0x9b, 0x02, 0x58, 0xae, 0xdb, 0x23, 0xd2, 0x9e,
    0xd9, 0xd4, 0x70, 0x27, 0x9b, 0x67, 0x72, 0xd0, 0xfe, 0xf8, 0xe4, 0x2e, 0x3b, 0x02, 0xd6, 0x52,
    0x81, 0xd4, 0x23, 0x73, 0x4c, 0x27, 0x05, 0x09, 0x9c, 0x27, 0xd9, 0x78, 0x60, 0x6e, 0xe4, 0xe1,
    0x84, 0x15, 0xb3, 0x0e, 0x88, 0x68, 0x85, 0x10, 0xda, 0x1e, 0xb1, 0xa0, 0x33, 0x72, 0x7b, 0x2c,
    0xa9, 0x25, 0xcc, 0x50, 0x16, 0x85, 0x7e, 0x43, 0x26, 0x93, 0x6f, 0x8d, 0x90, 0xf5, 0xba, 0x92,
    0x97, 0xa4, 0x3c, 0x07, 0x67, 0x16, 0x9e, 0x1e, 0x2a, 0xd5, 0xb5, 0xf6, 0x36, 0x72, 0x1e, 0x90,
    0xcc, 0xf5, 0x83, 0x85, 0x72, 0xf6, 0xc8, 0x28, 0x4e, 0x85, 0xf9, 0x21, 0x96, 0xaa, 0xf8, 0x2d,

    // Unknown 44 bytes, hash?
    0xd0, 0x01, 0x76, 0x9d, 0x82, 0x50, 0xca, 0x3e, 0x54, 0xfc, 0xdb, 0xde, 0x31, 0x1d, 0xa0, 0xb2,
    0xb1, 0xef, 0x13, 0xbd, 0xa3, 0x24, 0x1e, 0x11, 0xc8, 0xff, 0xb8, 0xba, 0xb7, 0x18, 0x79, 0xfb,
    0x02, 0x27, 0x30, 0x83, 0x06, 0x12, 0xec, 0x8f, 0x97, 0x23, 0x05, 0x00,
    
    // Exponent
    0x01, 0x00, 0x01
};

/*
 * Session IV for CMD6 AES-CBC decryption (g_disc_aes_iv_in at 0xD720)
 * This is used to decrypt the 48-byte key blob from the drive.
 */
static const uint8_t PS3DRIVE_SESSION_IV[16] = {
    0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

/*
 * Disc IV for final SACD sector decryption (g_session_aes_iv at 0xD710)
 * This is the static IV decrypted during CMD0 from internal keys.
 * Used together with the disc key to decrypt SACD audio sectors.
 */
static const uint8_t PS3DRIVE_DISC_IV[16] = {
    0x67, 0x94, 0xc8, 0x66, 0x6f, 0xb9, 0x0d, 0xf0,
    0xb6, 0x35, 0x0b, 0x18, 0x16, 0xd5, 0xc8, 0xf0
};

/**
 * RSA-1024 modulus N (128 bytes)
 * VERIFIED from emulator: at LS offset 0xD730
 */
static const uint8_t PS3DRIVE_RSA1024_N[128] = {
    0xbf, 0x4f, 0x65, 0x4e, 0xd2, 0x70, 0xfe, 0x7e, 0xa2, 0x34, 0xb0, 0x50, 0x3e, 0xa6, 0x42, 0x8c,
    0xc6, 0x54, 0x96, 0xe6, 0x52, 0x38, 0x0f, 0x30, 0x8f, 0xa7, 0x41, 0x65, 0xf2, 0xa4, 0x57, 0x1c,
    0xbc, 0xa1, 0x6d, 0x7a, 0x7f, 0xf3, 0x81, 0xe1, 0xd9, 0x2f, 0x93, 0xaf, 0xd4, 0x65, 0xd6, 0x71,
    0xc2, 0xc1, 0x47, 0x8f, 0x58, 0xd5, 0xd4, 0x8c, 0xb4, 0x56, 0x24, 0xa5, 0x28, 0xf6, 0x96, 0x03,
    0x6c, 0x21, 0x74, 0x62, 0x24, 0xa4, 0x95, 0x6d, 0x62, 0x50, 0x87, 0x13, 0x96, 0x79, 0x06, 0x49,
    0x61, 0x13, 0x92, 0x27, 0xc9, 0xd0, 0x01, 0x76, 0x9d, 0x82, 0x50, 0xca, 0x3e, 0x54, 0xfc, 0xdb,
    0xde, 0x31, 0x1d, 0xa0, 0xb2, 0xb1, 0xef, 0x13, 0xbd, 0xa3, 0x24, 0x1e, 0x11, 0xc8, 0xff, 0xb8,
    0xba, 0xb7, 0x18, 0x79, 0xfb, 0x02, 0x27, 0x30, 0x83, 0x06, 0x12, 0xec, 0x8f, 0x97, 0x23, 0x05
};

/**
 * RSA-1024 private exponent D (128 bytes)
 * VERIFIED from emulator: at LS offset 0xD730 + 128
 */
static const uint8_t PS3DRIVE_RSA1024_D[128] = {
    0x4e, 0x67, 0x90, 0xa2, 0x74, 0x36, 0xa0, 0xe6, 0x6f, 0x3d, 0xde, 0xc0, 0x94, 0x5c, 0x79, 0x4b,
    0xce, 0x80, 0x9e, 0x73, 0x78, 0x60, 0xc7, 0x40, 0xe4, 0xae, 0xec, 0x6b, 0x86, 0xbc, 0xf9, 0x82,
    0xaa, 0x80, 0x12, 0x29, 0x31, 0x45, 0x30, 0x06, 0xca, 0x86, 0xe8, 0x25, 0x18, 0x8c, 0x40, 0x0d,
    0xd1, 0x7e, 0x7b, 0x00, 0x71, 0xac, 0xf8, 0xf6, 0x4d, 0x76, 0x3c, 0x80, 0x7f, 0xc0, 0x47, 0x8c,
    0x1b, 0x0d, 0xa0, 0xb1, 0x81, 0x79, 0xde, 0x13, 0x01, 0xd2, 0xbf, 0xe4, 0xb5, 0xd6, 0x86, 0x82,
    0xbe, 0xf0, 0x6f, 0x53, 0x2d, 0x33, 0x1c, 0x02, 0x6d, 0xe7, 0xbc, 0xe1, 0xe2, 0xf6, 0x4f, 0x9d,
    0x85, 0x0a, 0x48, 0x60, 0x2d, 0x4e, 0x1d, 0xe9, 0x35, 0x8d, 0x7a, 0x4e, 0xde, 0xf9, 0x13, 0x88,
    0x38, 0x24, 0x39, 0xce, 0x9f, 0x25, 0xb3, 0x50, 0xed, 0x51, 0x1f, 0x4e, 0xd7, 0xe8, 0x35, 0x45
};

/**
 * RSA-1024 CRT components for faster decryption (optional)
 * VERIFIED from emulator: at LS offset 0xD730 + 256
 */
static const uint8_t PS3DRIVE_RSA1024_P[64] = {
    0xf6, 0xb7, 0x3a, 0x56, 0x04, 0x71, 0xbb, 0x8d, 0xf7, 0x14, 0x74, 0xf8, 0x68, 0x2f, 0x7d, 0xf6,
    0x3f, 0xdc, 0x9f, 0x26, 0x3c, 0xa9, 0xb7, 0x6c, 0x43, 0xfb, 0x80, 0x90, 0xad, 0xcf, 0x59, 0xd2,
    0x2b, 0xe2, 0x40, 0x5c, 0x2d, 0x45, 0x4a, 0x67, 0x8d, 0x0b, 0x58, 0x94, 0x2b, 0x47, 0x10, 0x0c,
    0xa4, 0xe3, 0xe9, 0xf0, 0x3c, 0x4b, 0x5a, 0xb3, 0xb9, 0x5e, 0xd7, 0x7a, 0xf8, 0x16, 0x8b, 0x4b
};

static const uint8_t PS3DRIVE_RSA1024_Q[64] = {
    0xc6, 0x82, 0x68, 0xf3, 0x0c, 0x24, 0x2d, 0x5e, 0x23, 0x4d, 0xf9, 0x1e, 0xd0, 0x95, 0x4d, 0x7c,
    0x56, 0xae, 0xea, 0xa9, 0x0e, 0xe5, 0x54, 0xeb, 0x84, 0x54, 0x73, 0xc6, 0x77, 0x71, 0x82, 0xc9,
    0x25, 0x04, 0xc3, 0xae, 0x6f, 0x7f, 0xec, 0x44, 0xaf, 0x7c, 0x4c, 0x79, 0x63, 0xbd, 0x3e, 0x91,
    0xb2, 0x41, 0xd7, 0x14, 0xa9, 0xd8, 0xd9, 0x7b, 0x6b, 0x30, 0x41, 0xd2, 0x09, 0x5a, 0x48, 0xef
};

static const uint8_t PS3DRIVE_RSA1024_DP[64] = {
    0xbb, 0x5e, 0x34, 0x23, 0x97, 0x84, 0x78, 0x98, 0x3c, 0x89, 0x80, 0xbc, 0x17, 0x03, 0xda, 0x79,
    0xe5, 0xce, 0x3b, 0xdf, 0xe2, 0x3a, 0x52, 0x5f, 0x1a, 0xd2, 0x2a, 0xb5, 0xb6, 0x0a, 0xbf, 0x80,
    0x6a, 0x6b, 0x8d, 0xcd, 0x73, 0x64, 0x28, 0x39, 0xb4, 0x58, 0x65, 0x91, 0x41, 0xbc, 0xda, 0x67,
    0x7f, 0xe2, 0xc7, 0x8b, 0xf7, 0x7e, 0x93, 0x07, 0xe3, 0x44, 0x30, 0x09, 0xe7, 0xd7, 0xd7, 0x39
};

static const uint8_t PS3DRIVE_RSA1024_DQ[64] = {
    0x39, 0xa6, 0x7c, 0x06, 0x41, 0xfb, 0x6b, 0xb5, 0x90, 0x39, 0x3f, 0xe5, 0x44, 0x1c, 0x68, 0x31,
    0x79, 0x17, 0x39, 0x8d, 0x39, 0x87, 0x3e, 0xbf, 0x5b, 0x62, 0x0f, 0x71, 0x8f, 0x14, 0xc7, 0x2f,
    0xd5, 0x71, 0x69, 0xc7, 0x0a, 0x18, 0xb3, 0xac, 0x4a, 0xee, 0xa5, 0x63, 0x07, 0xa5, 0x59, 0x3b,
    0x84, 0xf2, 0x7c, 0x1d, 0x43, 0x2a, 0x78, 0x16, 0xd0, 0xcd, 0x66, 0x00, 0x32, 0xb9, 0x26, 0xbf
};

static const uint8_t PS3DRIVE_RSA1024_QP[64] = {
    0x71, 0xd9, 0xd0, 0x84, 0x79, 0x68, 0x5b, 0x74, 0xb3, 0x5f, 0x31, 0x81, 0x37, 0x86, 0x59, 0x35,
    0xe6, 0xdd, 0x44, 0x00, 0x88, 0x8c, 0x97, 0xc2, 0x4c, 0x08, 0xa0, 0xcd, 0x7b, 0x86, 0x08, 0x09,
    0xe3, 0x61, 0xfe, 0x25, 0x2e, 0x86, 0x38, 0x26, 0x4d, 0x2e, 0x09, 0x8d, 0x63, 0x03, 0xad, 0xd1,
    0x02, 0x1b, 0x80, 0xaf, 0x4a, 0xcf, 0x21, 0x0f, 0x0c, 0x43, 0x34, 0x09, 0x7d, 0x2f, 0xdd, 0x1c
};

/**
 * CA Root Modulus for Certificate Chain Verification (128 bytes)
 *
 * From SPU binary at LS offset 0xCAF0 (g_rsa_init_modulus_data)
 * Used to verify drive certificates and derive the actual drive_pubkey.
 *
 * Formula for drive_pubkey derivation:
 *   decrypted = cert_modulus^65537 mod CA_ROOT_N
 *   drive_pubkey[0:89]   = decrypted[18:107]
 *   drive_pubkey[89:128] = cert_body[128:167] (padding bytes after modulus)
 */
static const uint8_t PS3DRIVE_CA_ROOT_N[128] = {
    0xbe, 0x95, 0xa0, 0xc4, 0x3e, 0xde, 0xaa, 0xde, 0x77, 0x7a, 0x54, 0x52, 0x1f, 0x5b, 0x98, 0x36,
    0xd8, 0xc1, 0xfa, 0x17, 0x07, 0x1f, 0x12, 0xdd, 0xf1, 0xb3, 0x02, 0x89, 0xcc, 0x9f, 0xb2, 0x42,
    0x00, 0x50, 0x8b, 0x87, 0x5e, 0x6f, 0x15, 0x5f, 0x9a, 0xb8, 0xd8, 0xb8, 0x08, 0xdb, 0x75, 0x26,
    0x82, 0xb2, 0x0c, 0xac, 0x56, 0xf8, 0xea, 0x22, 0x76, 0xdb, 0x52, 0xd8, 0x1e, 0x31, 0x95, 0xfe,
    0xa3, 0x1a, 0x53, 0x9f, 0x9a, 0xb9, 0xe6, 0x82, 0x32, 0xcc, 0x52, 0x37, 0x35, 0xe1, 0x8c, 0xec,
    0x41, 0x11, 0x2a, 0xad, 0xf8, 0xa6, 0x6d, 0xa7, 0x82, 0xba, 0x29, 0x7a, 0xac, 0x60, 0xce, 0xa3,
    0x23, 0xb0, 0x67, 0xd3, 0x57, 0xb3, 0x41, 0x0f, 0xcb, 0x84, 0x25, 0x31, 0x59, 0xca, 0xd5, 0x5b,
    0x66, 0x64, 0xfd, 0x88, 0x8f, 0x19, 0x6b, 0xb7, 0x8e, 0xb2, 0xbe, 0x85, 0xeb, 0xeb, 0xdd, 0x1f
};

/* ============================================================================
 * PAIRING KEYS (unchanged from original)
 * ============================================================================ */

static const uint8_t PS3DRIVE_PBLOCK_KEY[96] = {
  0x79, 0xb1, 0x86, 0x77, 0x45, 0xe6, 0x9f, 0x0c, 0x06, 0xa2, 0xbd, 0x72,
  0xc8, 0x0a, 0xe9, 0x53, 0x2f, 0xbf, 0xdc, 0xdb, 0xac, 0x21, 0xf1, 0x5f,
  0x40, 0x53, 0x1c, 0xf6, 0x18, 0xcf, 0x16, 0x40, 0x51, 0xa0, 0x86, 0x33,
  0x19, 0x99, 0x00, 0xa4, 0x18, 0x44, 0x69, 0x34, 0xd3, 0xa7, 0x66, 0x48,
  0x04, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfd, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x47, 0x28, 0x45, 0x18,
  0xf8, 0x60, 0x8c, 0x62, 0x82, 0xc6, 0xd7, 0x34, 0x33, 0xb1, 0xa3, 0x4a
};

/** DES-CBC IV for P-Block/S-Block decryption (all zeros) */
static const uint8_t PS3DRIVE_PBLOCK_IV[8] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

/** S-Block key (1648 bytes) */
static const uint8_t PS3DRIVE_SBLOCK_KEY[1648] = {
  0x79, 0xb1, 0x86, 0x77, 0x45, 0xe6, 0x9f, 0x0c, 0x06, 0xa2, 0xbd, 0x72,
  0xc8, 0x0a, 0xe9, 0x53, 0x88, 0xaf, 0x29, 0xfc, 0xa0, 0xc7, 0x8e, 0x16,
  0x79, 0xb3, 0xb6, 0x44, 0x8a, 0x77, 0xc2, 0x4b, 0xac, 0xb8, 0xd7, 0x91,
  0x47, 0xc0, 0x5b, 0x45, 0xdb, 0x6e, 0xe7, 0xb2, 0x01, 0x11, 0x8d, 0x3b,
  0x12, 0xce, 0x5c, 0xaf, 0xb9, 0x0c, 0xdf, 0x20, 0xc3, 0x1c, 0x8a, 0x3e,
  0xfd, 0x1f, 0x40, 0x2d, 0x65, 0x49, 0x53, 0xe8, 0x9e, 0x95, 0xc7, 0x5d,
  0x42, 0xa6, 0xa3, 0x1d, 0x1a, 0xcf, 0x84, 0x7b, 0x4f, 0x89, 0x69, 0x4d,
  0xba, 0xf8, 0xce, 0x2b, 0xb2, 0x87, 0xc0, 0x83, 0xb5, 0x50, 0x4f, 0xff,
  0xe9, 0xf7, 0x7b, 0x39, 0x62, 0xd9, 0x43, 0xf8, 0xc5, 0xb0, 0xa6, 0x4d,
  0xca, 0xd1, 0xa1, 0x10, 0xb4, 0xa2, 0x6b, 0x9d, 0xac, 0xe0, 0xf3, 0xc4,
  0x8c, 0x63, 0x27, 0xcf, 0x35, 0x3f, 0xcf, 0x6c, 0x21, 0xfc, 0x95, 0xac,
  0x88, 0xee, 0x2b, 0xb3, 0x3b, 0xe3, 0xbc, 0x8f, 0xd1, 0x67, 0x90, 0x9c,
  0x5f, 0xc3, 0xaa, 0xb0, 0x55, 0xd1, 0x33, 0x35, 0x7f, 0x50, 0xae, 0xb3,
  0x98, 0xa2, 0x46, 0xf8, 0x6e, 0x6a, 0x60, 0x19, 0x8b, 0x01, 0xb6, 0x82,
  0x97, 0xec, 0x69, 0xe2, 0xb7, 0x1c, 0x3b, 0x6c, 0xe2, 0x93, 0x00, 0x6b,
  0x56, 0x57, 0x1e, 0x76, 0xa5, 0x07, 0x27, 0xd6, 0x4a, 0x35, 0xf9, 0x08,
  0xa0, 0x90, 0x91, 0x2e, 0xa0, 0xda, 0xa7, 0xf3, 0x45, 0xe0, 0x5f, 0xd7,
  0x99, 0x1c, 0x8a, 0xb1, 0x8a, 0xed, 0x77, 0x66, 0xc0, 0x56, 0xac, 0x68,
  0x4e, 0x67, 0x25, 0x79, 0x30, 0xc5, 0x44, 0x85, 0x04, 0xec, 0x7c, 0xf8,
  0x13, 0xb3, 0xff, 0xd8, 0xf2, 0xca, 0xe6, 0x14, 0x8e, 0x1b, 0xf7, 0x89,
  0x14, 0x4b, 0x82, 0x2c, 0xda, 0x1c, 0x8d, 0x7b, 0xc0, 0x01, 0x64, 0xdb,
  0xdf, 0x44, 0xe8, 0x56, 0x1e, 0xae, 0x2e, 0xcb, 0x78, 0x07, 0x1c, 0x4f,
  0x32, 0x1c, 0x71, 0x00, 0xbb, 0xd9, 0x40, 0xfb, 0xbe, 0x7b, 0x69, 0xef,
  0x71, 0x80, 0x0a, 0x70, 0x13, 0x61, 0xf2, 0x96, 0x8a, 0x68, 0x72, 0x47,
  0x88, 0xbf, 0x4f, 0xa3, 0x6e, 0xb6, 0x35, 0x20, 0xe5, 0x33, 0xe4, 0xe8,
  0xbe, 0x6d, 0x57, 0xa4, 0x18, 0xa1, 0x29, 0x3e, 0xb3, 0x12, 0x05, 0x0f,
  0xa6, 0x4c, 0xf6, 0x90, 0x09, 0x5f, 0x85, 0xc1, 0xad, 0xad, 0xda, 0x9f,
  0x04, 0xab, 0x25, 0x56, 0xed, 0x0c, 0x26, 0x50, 0x3c, 0xd6, 0xd2, 0x43,
  0x12, 0xe1, 0x76, 0x2c, 0x59, 0x44, 0xa2, 0x6b, 0x2c, 0x98, 0x5f, 0x84,
  0x0c, 0x8a, 0xbc, 0xff, 0x60, 0xb1, 0x90, 0x3d, 0xef, 0x4e, 0x24, 0xe2,
  0x12, 0x05, 0x10, 0x99, 0x34, 0x56, 0x77, 0x41, 0x40, 0x19, 0xb8, 0xce,
  0x6f, 0x81, 0xff, 0x8f, 0xf1, 0xd7, 0x7f, 0xab, 0x66, 0x99, 0xd0, 0x67,
  0x09, 0x62, 0xe9, 0x9a, 0xde, 0x60, 0x96, 0xd4, 0x1c, 0x28, 0xdc, 0xec,
  0xb1, 0x4c, 0x92, 0x07, 0x32, 0xc2, 0x28, 0xd9, 0xcc, 0x1a, 0xc0, 0xf2,
  0xd8, 0xed, 0xb5, 0x25, 0x27, 0xee, 0x9c, 0x29, 0x63, 0x0b, 0x44, 0xa6,
  0x02, 0x9d, 0x41, 0x8f, 0xdf, 0xf4, 0xc0, 0x0f, 0x76, 0x35, 0xbc, 0x16,
  0x31, 0xa5, 0x6f, 0x72, 0x0d, 0x0a, 0xc8, 0xae, 0xa9, 0xf6, 0x18, 0xd9,
  0x40, 0xbd, 0xa3, 0x2d, 0x48, 0xf2, 0x0e, 0xf4, 0xcf, 0xa3, 0x9f, 0xa8,
  0xc0, 0x66, 0x78, 0x77, 0x9c, 0xe2, 0x6a, 0xa9, 0xe2, 0xab, 0xd0, 0xd9,
  0xfb, 0xcc, 0xb9, 0x67, 0x80, 0xb4, 0x6a, 0x52, 0xbb, 0x98, 0x72, 0x01,
  0xed, 0x9b, 0x94, 0x55, 0xf9, 0xb0, 0x74, 0x66, 0x52, 0xf4, 0x0d, 0x32,
  0x23, 0x09, 0x0e, 0xe9, 0x8a, 0xff, 0xf7, 0xf2, 0xb3, 0x44, 0x04, 0x46,
  0xb2, 0xee, 0x1a, 0x47, 0x02, 0xf2, 0xf1, 0xce, 0x48, 0x75, 0x71, 0x57,
  0x7d, 0xb3, 0xc1, 0xd8, 0xcc, 0x21, 0xf9, 0x5f, 0x92, 0x6b, 0x44, 0xff,
  0x8e, 0x4a, 0x8e, 0x55, 0x01, 0x55, 0x00, 0xbb, 0x7c, 0xd0, 0xb1, 0xf7,
  0x78, 0xba, 0xff, 0xec, 0x47, 0x7c, 0x21, 0x83, 0x9f, 0x3e, 0x87, 0x64,
  0x22, 0x54, 0xdc, 0xc5, 0x6a, 0xe6, 0x69, 0xe4, 0xa9, 0x7d, 0xc0, 0x24,
  0x10, 0x38, 0x44, 0x1a, 0x66, 0xea, 0x16, 0x0b, 0x03, 0x6a, 0x3b, 0xa5,
  0x04, 0x43, 0xe7, 0xb4, 0xcf, 0x3e, 0xfe, 0xe6, 0x3a, 0x2c, 0x00, 0x25,
  0xf2, 0x10, 0x5f, 0xcf, 0x90, 0xe9, 0x0b, 0x8a, 0xd0, 0x27, 0x04, 0x1c,
  0x41, 0x67, 0x36, 0x22, 0x2c, 0xa9, 0xfc, 0x31, 0xa3, 0x0c, 0x23, 0x5d,
  0x61, 0xe6, 0x7a, 0x2a, 0xe4, 0x45, 0x0b, 0x46, 0xd5, 0x5c, 0xbc, 0x4d,
  0xa9, 0x83, 0x2a, 0x06, 0x67, 0x0f, 0xbb, 0xe2, 0xe0, 0xf3, 0xab, 0x1d,
  0x91, 0x8e, 0xd2, 0x19, 0x3b, 0xbf, 0x70, 0x71, 0xe4, 0x1b, 0xad, 0x95,
  0xc5, 0x9e, 0x16, 0x46, 0xe2, 0x21, 0x97, 0x66, 0x5c, 0x23, 0xe2, 0x5d,
  0xfd, 0x39, 0x6b, 0xa9, 0x1a, 0xd2, 0x6c, 0x3c, 0x6a, 0xef, 0x53, 0xae,
  0xae, 0x8c, 0xf7, 0x37, 0xed, 0x7f, 0x6f, 0x86, 0xc1, 0x75, 0xff, 0xb9,
  0x94, 0xbb, 0x46, 0x61, 0xad, 0x9b, 0xea, 0x03, 0x1e, 0xe3, 0x52, 0xb5,
  0x10, 0xa5, 0xd9, 0x7a, 0x42, 0xc2, 0x09, 0x66, 0x9b, 0x2c, 0x95, 0x79,
  0xf8, 0xd7, 0xa6, 0x0f, 0xc8, 0x49, 0x09, 0xab, 0x90, 0xde, 0xec, 0x70,
  0x40, 0xfb, 0x0d, 0xd7, 0x81, 0xc4, 0xce, 0x71, 0x00, 0xa6, 0x9d, 0x02,
  0xf8, 0xa9, 0xdc, 0x36, 0xc2, 0x7f, 0xf2, 0x0e, 0xbc, 0x8b, 0xb5, 0x1a,
  0x61, 0x6b, 0x9f, 0x9b, 0x19, 0x87, 0x71, 0xb4, 0xd9, 0x12, 0x3f, 0xea,
  0x09, 0x4a, 0xe4, 0xdb, 0x36, 0xc9, 0xb0, 0xc6, 0xad, 0x18, 0xc7, 0xe2,
  0xed, 0x95, 0x69, 0x4d, 0x17, 0x71, 0x60, 0x89, 0x46, 0x71, 0x18, 0x32,
  0x15, 0x8c, 0xa9, 0xc8, 0xe1, 0x73, 0x11, 0x49, 0x98, 0x46, 0xfa, 0x62,
  0x6c, 0x20, 0x2b, 0x7b, 0x25, 0x47, 0x5b, 0x00, 0x4d, 0x9c, 0x59, 0x27,
  0xe6, 0xeb, 0xc7, 0x39, 0xfc, 0x6b, 0x19, 0x58, 0xf6, 0xb9, 0x61, 0x71,
  0x99, 0xf8, 0xf3, 0x9c, 0x9a, 0x41, 0x18, 0x7d, 0xa4, 0xff, 0x4f, 0x0b,
  0xf0, 0x91, 0x01, 0x76, 0x2e, 0x5e, 0x36, 0x19, 0x8e, 0x83, 0xa8, 0x38,
  0xcb, 0x83, 0x0e, 0x00, 0xc9, 0x82, 0x5c, 0xf4, 0x38, 0xe8, 0xa9, 0xe1,
  0x76, 0xe0, 0x1f, 0xeb, 0xd1, 0x03, 0x45, 0xf9, 0x0a, 0xc8, 0x62, 0x84,
  0x7f, 0x11, 0x7c, 0xf3, 0x89, 0x5a, 0x64, 0x8b, 0xea, 0xb6, 0xbd, 0xf5,
  0x81, 0xfd, 0xa8, 0xd7, 0x12, 0x82, 0xea, 0xee, 0x56, 0xf2, 0xe4, 0x15,
  0xf9, 0xcd, 0x8c, 0x19, 0x07, 0xf3, 0x84, 0x71, 0xc8, 0xad, 0xd0, 0x2c,
  0x28, 0xa7, 0x3e, 0x8a, 0x0f, 0x8e, 0xd5, 0x11, 0x92, 0xc8, 0x5d, 0x33,
  0xc3, 0x40, 0x9b, 0xeb, 0xd1, 0x6e, 0x12, 0xa8, 0x03, 0x42, 0xfa, 0x3a,
  0x6b, 0x20, 0x48, 0x83, 0x3e, 0x06, 0x0a, 0x27, 0x59, 0x97, 0x10, 0x26,
  0x49, 0x0a, 0x0d, 0x91, 0xb2, 0x02, 0x7e, 0xa0, 0xcd, 0x83, 0x60, 0x36,
  0x8f, 0xb3, 0x58, 0xad, 0x0e, 0x52, 0xec, 0xe4, 0xe4, 0x56, 0x2a, 0xb7,
  0x48, 0x37, 0x08, 0x03, 0x6b, 0xe7, 0xad, 0x16, 0x1a, 0x25, 0x0e, 0xfd,
  0x85, 0x36, 0x0f, 0xa7, 0x52, 0x51, 0x12, 0x0f, 0xef, 0x35, 0x04, 0xca,
  0xaf, 0xd5, 0x88, 0xa5, 0x5a, 0x01, 0xca, 0xf5, 0x57, 0x17, 0x9c, 0x40,
  0x72, 0xb6, 0xe4, 0xa7, 0x6e, 0x79, 0x3e, 0xe1, 0x3a, 0x83, 0x57, 0x0d,
  0x8b, 0x62, 0x8a, 0x6f, 0x5c, 0xad, 0x34, 0xf3, 0x02, 0x94, 0x0f, 0x8d,
  0x9f, 0xac, 0x8c, 0xcd, 0xc0, 0x99, 0x49, 0xae, 0x24, 0xd9, 0xcf, 0x06,
  0x2d, 0x25, 0x91, 0x82, 0x25, 0x56, 0xb2, 0x2e, 0x97, 0x34, 0xc7, 0xb7,
  0xc0, 0x33, 0xec, 0xea, 0x48, 0x6f, 0xb8, 0xce, 0xa5, 0x74, 0x43, 0x8f,
  0x3b, 0x79, 0xe0, 0x1f, 0xe6, 0x71, 0xd8, 0x20, 0xbf, 0x6b, 0x34, 0x98,
  0x89, 0x8c, 0xab, 0x40, 0x46, 0x86, 0x1d, 0x6d, 0x88, 0x10, 0xfd, 0x35,
  0xfe, 0x8c, 0x05, 0xb8, 0x2f, 0x61, 0x4a, 0x3b, 0xe6, 0x94, 0x62, 0x70,
  0x29, 0xaa, 0x7a, 0xe7, 0xbf, 0x3a, 0x58, 0xb8, 0x96, 0x58, 0x0f, 0x3e,
  0xb6, 0xd8, 0xe6, 0xa1, 0x11, 0xc2, 0x4f, 0x02, 0x23, 0xc0, 0x5d, 0x12,
  0xe9, 0x71, 0x5f, 0xa6, 0xca, 0x1b, 0x57, 0x24, 0x0c, 0xcf, 0x4f, 0xeb,
  0xfe, 0xcf, 0xba, 0x47, 0x8e, 0x08, 0x97, 0x11, 0x81, 0x84, 0x71, 0x9f,
  0xe5, 0x05, 0x4a, 0x31, 0x9d, 0x25, 0x46, 0xd9, 0x6a, 0x42, 0x96, 0xd7,
  0x56, 0xbb, 0x8b, 0x91, 0xb2, 0xea, 0x64, 0x91, 0x59, 0x68, 0x92, 0x6c,
  0xb1, 0x8d, 0x6e, 0x5f, 0x69, 0xe6, 0xb9, 0xbe, 0xd0, 0x63, 0xf8, 0x66,
  0x09, 0x0b, 0x9e, 0xde, 0xb1, 0xe3, 0x9a, 0x2b, 0xc0, 0x81, 0x39, 0x7b,
  0x3b, 0x33, 0xf4, 0xda, 0x8f, 0xb0, 0x77, 0x7d, 0x8f, 0x4a, 0x5c, 0xe0,
  0xfe, 0xfa, 0xb4, 0xd9, 0xee, 0x8a, 0xd3, 0xb1, 0xe6, 0xce, 0x6e, 0x25,
  0x9d, 0x42, 0xfc, 0xf9, 0xf8, 0x48, 0x20, 0xc3, 0xba, 0x7f, 0x33, 0x96,
  0x92, 0x13, 0x62, 0xea, 0x88, 0xcd, 0x99, 0x4c, 0xb1, 0xd8, 0x1f, 0xac,
  0x9d, 0xf6, 0xa4, 0x8f, 0xd1, 0xf8, 0xed, 0x43, 0xcb, 0x27, 0xa8, 0x33,
  0x20, 0x4f, 0x92, 0x95, 0xd5, 0xfd, 0xd3, 0x5f, 0x75, 0x69, 0x45, 0x1d,
  0x4e, 0x48, 0x61, 0xe4, 0x89, 0x2d, 0x2b, 0xf8, 0x8d, 0xb0, 0x7e, 0x11,
  0xfe, 0x80, 0x0e, 0x8b, 0x3c, 0x1c, 0xfa, 0xed, 0x00, 0x6f, 0xde, 0x8a,
  0x5a, 0x4a, 0x48, 0x6e, 0xca, 0x6e, 0x02, 0x32, 0xd4, 0x07, 0x39, 0xb8,
  0x38, 0xd1, 0x81, 0x66, 0x40, 0x42, 0x7c, 0x64, 0xaa, 0x93, 0x22, 0xdf,
  0x72, 0xa0, 0x7d, 0x9f, 0xbe, 0x89, 0xe4, 0x31, 0x65, 0x89, 0x68, 0xf6,
  0x87, 0xfb, 0x6f, 0x16, 0x74, 0x4d, 0xd1, 0xf9, 0x5e, 0x8e, 0x7d, 0x81,
  0xef, 0xe4, 0x85, 0xf2, 0xa4, 0x7c, 0x90, 0x17, 0x18, 0xb3, 0x69, 0xa7,
  0xce, 0x85, 0xee, 0xcf, 0xed, 0x24, 0x4b, 0xef, 0x2e, 0x9a, 0x22, 0xd5,
  0x56, 0xd3, 0x1b, 0x51, 0x25, 0x15, 0x84, 0xf3, 0x45, 0xed, 0x73, 0xe4,
  0xfa, 0x2a, 0xf9, 0x38, 0x52, 0xb3, 0x84, 0x94, 0x4e, 0xbd, 0x7d, 0x06,
  0x75, 0xdf, 0x1b, 0x72, 0x23, 0xae, 0x84, 0x43, 0x3b, 0x89, 0x52, 0xba,
  0xb5, 0xf7, 0x6b, 0xd1, 0x97, 0x28, 0x82, 0xbb, 0x10, 0x8c, 0xec, 0xab,
  0x3e, 0xaf, 0x00, 0x74, 0x08, 0xfd, 0x4f, 0xa1, 0x42, 0x19, 0xef, 0xb7,
  0x83, 0x88, 0x01, 0x9b, 0xac, 0x27, 0x3f, 0x11, 0x91, 0x58, 0xed, 0x14,
  0x86, 0x54, 0xe0, 0xa4, 0x8f, 0x23, 0xc3, 0xba, 0xdb, 0x5c, 0x15, 0x0d,
  0x01, 0xbc, 0xea, 0x81, 0x06, 0x65, 0xc3, 0xd8, 0xc9, 0x66, 0x91, 0xf7,
  0xcb, 0xd2, 0x4f, 0xea, 0x69, 0x6c, 0x9d, 0x71, 0x0e, 0x4f, 0x94, 0xfe,
  0x0f, 0x02, 0x5a, 0xf1, 0xec, 0xc0, 0x2d, 0xd5, 0x0c, 0x7f, 0x1c, 0xdf,
  0xaf, 0xfb, 0xbb, 0x1c, 0xf0, 0x15, 0x1d, 0x6e, 0x7f, 0xb3, 0x34, 0x1a,
  0xa3, 0x2c, 0xf3, 0x74, 0x52, 0x1c, 0xe0, 0x59, 0xd8, 0x4c, 0x4c, 0xd6,
  0x1c, 0x6c, 0xc2, 0x47, 0xe7, 0x81, 0xd2, 0xd4, 0x50, 0x5b, 0xb5, 0x8b,
  0x03, 0xff, 0x36, 0xb7, 0xd7, 0xb2, 0x5d, 0xca, 0x25, 0x6d, 0xdc, 0x9e,
  0x9a, 0xc1, 0x17, 0xa5, 0xa1, 0x37, 0x5a, 0xb2, 0xaa, 0x40, 0xf0, 0x50,
  0x80, 0xd2, 0xc9, 0xf1, 0x7d, 0x28, 0x73, 0x69, 0x4f, 0xf6, 0xe6, 0xe2,
  0x23, 0x25, 0x8d, 0x6c, 0xaf, 0x2a, 0x0a, 0x32, 0x13, 0x9d, 0xa1, 0x40,
  0x8a, 0xab, 0x3e, 0xc0, 0xfb, 0x0d, 0x0b, 0xf6, 0x59, 0xf5, 0x1f, 0x85,
  0x8d, 0x2d, 0xfe, 0x27, 0x57, 0xe3, 0xf2, 0xed, 0xa9, 0x47, 0x03, 0xba,
  0x5b, 0xd7, 0x95, 0x49, 0xa0, 0xee, 0xf8, 0xd4, 0xcf, 0x31, 0xf2, 0xea,
  0xb2, 0xae, 0x6a, 0xca, 0xdc, 0x54, 0x48, 0xe5, 0x77, 0x1a, 0x9f, 0xd8,
  0xad, 0x3b, 0xdf, 0xe4, 0xaa, 0x42, 0xe6, 0xdd, 0xad, 0xad, 0xda, 0x9f,
  0x04, 0xab, 0x25, 0x56, 0xed, 0x0c, 0x26, 0x50, 0x3c, 0xd6, 0xd2, 0x43,
  0x48, 0x81, 0x8a, 0x57, 0x09, 0x0e, 0x53, 0x65, 0x64, 0x2b, 0x14, 0x3a,
  0xf5, 0x27, 0x32, 0x3f
};

/**
 * Default HRL data (84 bytes).
 *
 * This is the default Host Revocation List that can be written to
 * the drive to restore BD playback functionality.
 *
 * Source: Dumped from Lv2diag.self
 */
static const uint8_t PS3DRIVE_DEFAULT_HRL[84] = {
    0x10, 0x00, 0x00, 0x0c, 0x00, 0x03, 0x10, 0x03, 0x00, 0x00, 0x00, 0x01,
    0x21, 0x00, 0x00, 0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x1b, 0x0b, 0xf2, 0x6d, 0x47, 0x9e, 0x77, 0x62, 0x3d, 0x91, 0xfc, 0x78,
    0xb1, 0x59, 0xc9, 0x52, 0xca, 0xa4, 0xc7, 0x41, 0x85, 0x24, 0x96, 0x64,
    0x8d, 0x1d, 0x95, 0x8e, 0x9b, 0x84, 0xc6, 0xfa, 0x4a, 0xdd, 0x43, 0x9b,
    0x42, 0x98, 0xfe, 0xff, 0xdf, 0xe6, 0xf3, 0x56, 0x85, 0x81, 0xe1, 0x1b,
  0x27, 0x53, 0x08, 0x14, 0x16, 0x6d, 0x97, 0x3c, 0x20, 0x2d, 0xe2, 0x97,
};

/** Size of the default HRL data */
#define PS3DRIVE_DEFAULT_HRL_SIZE  32768

/* ============================================================================
 * DRIVE TYPE IDENTIFICATION
 * ============================================================================ */

/**
 * Drive identification table.
 *
 * Maps product ID strings from INQUIRY to hardware type identifiers.
 */
typedef struct {
    const char *product_id;
    uint64_t    type_id;
} ps3drive_id_entry_t;

static const ps3drive_id_entry_t PS3DRIVE_ID_TABLE[] = {
    { "PS-SYSTEM   300R", 0x1200000000000001ULL },
    { "PS-SYSTEM   301R", 0x1200000000000002ULL },
    { "PS-SYSTEM   302R", 0x1200000000000003ULL },
    { "PS-SYSTEM   303R", 0x1200000000000004ULL },
    { "PS-SYSTEM   304R", 0x1200000000000005ULL },
    { "PS-SYSTEM   306R", 0x1200000000000007ULL },
    { "PS-SYSTEM   308R", 0x1200000000000008ULL },
    { "PS-SYSTEM   310R", 0x1200000000000009ULL },
    { "PS-SYSTEM   312R", 0x120000000000000aULL },
    { "PS-SYSTEM   314R", 0x120000000000000bULL },
};

#define PS3DRIVE_ID_TABLE_SIZE \
    (sizeof(PS3DRIVE_ID_TABLE) / sizeof(PS3DRIVE_ID_TABLE[0]))

/* ============================================================================
 * REQUEST SENSE MESSAGES
 * ============================================================================ */

/**
 * Request sense code to message mapping for firmware update.
 */
typedef struct {
    unsigned int req_sense;
    const char  *message;
} ps3drive_sense_entry_t;

static const ps3drive_sense_entry_t PS3DRIVE_SENSE_TABLE[] = {
    { 0x20407, "because of invalid command issued. ignore it" },
    { 0x23a00, "success" },
    { 0x43e01, "failure erasing or writing flash of BD drive" },
    { 0x52400, "invalid data length or continuous error" },
    { 0x52600, "invalid firmware combination or hash error" },
};

#define PS3DRIVE_SENSE_TABLE_SIZE \
    (sizeof(PS3DRIVE_SENSE_TABLE) / sizeof(PS3DRIVE_SENSE_TABLE[0]))

#ifdef __cplusplus
}
#endif

#endif /* LIBPS3DRIVE_PS3DRIVE_KEYS_H */
